unit_tests:
  - name: test_curated_message_check
    model: curated_message_check
    given:
      - input: source('LAND','MESSAGE_CHECK')
        format: csv
        rows: |
          FORUM_SOURCE,TOPIC_NUMBER,USER,MESSAGE_FORUM_ID,CREATION_TIME_LOCAL,EDITION_TIME_LOCAL,MESSAGE_CONTENT
          BI,108506,user1,1,2024-01-02 03:04:05,,blabla1
          BI,108506,user2,2,2024-06-07 08:09:10,2024-11-12 00:13:14,blabla2


      - input: ref('curated_topic')
        format: csv
        rows: |
          TOPIC_KEY,FORUM_KEY,SEASON_KEY,FORUM_SOURCE,TOPIC_NUMBER,IS_FOR_PREDICT,IS_FOR_RESULT
          44ee900ed19db8d1f9a75dbd7b187ca4,b4d2197189f192c4e623999bc6167df1,ab79b12cfeaf0cc39dc7676a91fa737a,BI,108506,1,0
          79a1de01beddb1503307b5c7e62e661c,b4d2197189f192c4e623999bc6167df1,ab79b12cfeaf0cc39dc7676a91fa737a,BI,108504,0,1

      - input: ref('curated_season')
        format: csv
        rows: |
          SEASON_KEY,SEASON_ID,SEASON_SPORT,SEASON_COUNTRY,SEASON_NAME,SEASON_DIVISION,SEASON_TEAMCHOICE_DEADLINE
          ab79b12cfeaf0cc39dc7676a91fa737a,S1,BASKETBALL,FRANCE,2024-2025,PROB,2025-05-09

      - input: ref('curated_user')
        format: csv
        rows: |
          USER_KEY,USER_NAME,SEASON_KEY
          5ce84b3ad151935f085d6ba5ab876466,user1,ab79b12cfeaf0cc39dc7676a91fa737a
          b483a4ac17ceeab782129cfc915a9d37,user2,ab79b12cfeaf0cc39dc7676a91fa737a

      - input: ref('curated_forum')
          FORUM_KEY,FORUM_SOURCE,FORUM_COUNTRY
          b4d2197189f192c4e623999bc6167df1,BI,FRANCE

      - input: ref('local_time')
        format: csv
        rows: |
          COUNTRY,TIMEZONE
          FRANCE,Europe/Paris

    expect:
      format: csv
      rows: |
        MESSAGE_KEY,MESSAGE_EDITION_KEY,FORUM_KEY,TOPIC_KEY,SEASON_KEY,USER_KEY,MESSAGE_FORUM_ID,CREATION_TIME_LOCAL,EDITION_TIME_LOCAL,CREATION_TIME_UTC,EDITION_TIME_UTC,"MESSAGE_CONTENT","IS_PROGRAM_INIT_MESSAGE","IS_PROGRAM_CALCUL_MESSAGE","IS_MESSAGE_TO_AVOID","IS_MESSAGE_TO_PROCESS","DBT_SCD_ID","DBT_UPDATED_AT","DBT_VALID_FROM","DBT_VALID_TO"
        bc14c3478253399ae4b70c615f195e16,5de9cb296288baea2ccb63e2d9915c89,b4d2197189f192c4e623999bc6167df1,44ee900ed19db8d1f9a75dbd7b187ca4,ab79b12cfeaf0cc39dc7676a91fa737a,5ce84b3ad151935f085d6ba5ab876466,1,2024-01-02 03:04:05,2024-01-02 03:04:05,2024-01-02 02:04:05,2024-01-02 02:04:05,"#F-B.01# Le Portel vs Gries-Souffel ==> +9 ;;;;; #F-B.BN# Identifiant du match bonus ==> F-B.01","0","0","0","1","b4f77c7ddf65404bbb00d3677c2a9a26","2025-06-14 08:43:00","2025-06-14 08:43:00",""
        b73cfb3d12a7665615a641a465fa2c11,22207fb0ac63d3f85d43ba8b383ee5b7,b4d2197189f192c4e623999bc6167df1,44ee900ed19db8d1f9a75dbd7b187ca4,ab79b12cfeaf0cc39dc7676a91fa737a,b483a4ac17ceeab782129cfc915a9d37,2,2024-06-07 08:09:10,2024-11-12 00:13:14,2024-06-07 06:09:10,2024-11-11 23:13:14,"#F-B.01# Le Portel vs Gries-Souffel ==> +12 ;;;;; #F-B.BN# Identifiant du match bonus ==> F-B.01","0","0","0","1","587ccf962f1d729c8990e16d11a938e5","2025-06-14 07:03:00","2025-06-14 07:03:00",""

